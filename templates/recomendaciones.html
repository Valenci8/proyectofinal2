<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recomendaciones Personalizadas - IncluLearn</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #4cc9f0;
            --success: #4ade80;
            --warning: #f59e0b;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin: 30px auto;
            overflow: hidden;
            max-width: 1200px;
        }
        
        .header-section {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 40px 0;
            text-align: center;
        }
        
        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
        }
        
        .progress-ring-circle {
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        
        .recommendation-card {
            border: none;
            border-radius: 15px;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .recommendation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .card-high-priority {
            border-left: 5px solid var(--danger);
        }
        
        .card-medium-priority {
            border-left: 5px solid var(--warning);
        }
        
        .card-low-priority {
            border-left: 5px solid var(--success);
        }
        
        .priority-badge {
            position: absolute;
            top: 15px;
            right: 15px;
        }
        
        .progress-section {
            background: var(--light);
            padding: 30px;
            border-radius: 15px;
        }
        
        .course-progress {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .achievement-badge {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent), var(--primary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin: 0 auto 10px;
        }
        
        .stats-card {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            background: white;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .btn-action {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
        }
        
        .completion-checkbox {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid #dee2e6;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .completion-checkbox.checked {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }
        
        .level-indicator {
            height: 8px;
            border-radius: 4px;
            background: #e2e8f0;
            overflow: hidden;
        }
        
        .level-progress {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .notification-dot {
            width: 8px;
            height: 8px;
            background: var(--danger);
            border-radius: 50%;
            position: absolute;
            top: 8px;
            right: 8px;
        }
        
        .floating-action {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }
        
        .interactive-element {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .interactive-element:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: rgba(30, 41, 59, 0.9);">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-graduation-cap"></i> IncluLearn
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">Inicio</a>
                <a class="nav-link" href="/cursos">Cursos</a>
                <a class="nav-link" href="/resolver">Resolver Problemas</a>
                <a class="nav-link active" href="/recomendaciones">Recomendaciones</a>
                <a class="nav-link" href="/login" id="loginLink">Iniciar Sesi칩n</a>
            </div>
        </div>
    </nav>

    <div class="container main-container my-5">
        <!-- Header Section -->
        <div class="header-section">
            <div class="container">
                <h1 class="display-5 fw-bold mb-3">Recomendaciones Personalizadas</h1>
                <p class="lead mb-4">Basado en tu progreso de aprendizaje</p>
                
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="progress-ring">
                            <svg width="120" height="120" viewBox="0 0 120 120">
                                <circle cx="60" cy="60" r="54" fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="8"/>
                                <circle class="progress-ring-circle" cx="60" cy="60" r="54" fill="none" stroke="white" stroke-width="8" stroke-dasharray="339.292" stroke-dashoffset="0" id="overallProgressRing"/>
                            </svg>
                        </div>
                        <h3 id="overallProgressText">65% Completado</h3>
                        <p class="mb-0">Nivel: <span id="userLevel">Intermedio</span></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="container py-5">
            <div class="row">
                <!-- Main Recommendations -->
                <div class="col-lg-8">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Tus Recomendaciones</h3>
                        <span class="badge bg-primary" id="recommendationCount">5 recomendaciones</span>
                    </div>
                    
                    <!-- Priority Filters -->
                    <div class="d-flex gap-2 mb-4">
                        <button class="btn btn-outline-primary btn-sm active" data-filter="all">Todas</button>
                        <button class="btn btn-outline-danger btn-sm" data-filter="alta">Alta Prioridad</button>
                        <button class="btn btn-outline-warning btn-sm" data-filter="media">Media Prioridad</button>
                        <button class="btn btn-outline-success btn-sm" data-filter="baja">Baja Prioridad</button>
                    </div>
                    
                    <div id="recommendationsContainer">
                        <!-- Recommendations will be loaded here -->
                    </div>
                    
                    <!-- Daily Challenge -->
                    <div class="card recommendation-card mt-4">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="badge bg-info mb-2">Desaf칤o Diario</span>
                                    <h5 class="card-title mb-1" id="dailyChallengeTitle">Resolver 5 problemas matem치ticos</h5>
                                    <p class="card-text text-muted" id="dailyChallengeDesc">Completa este desaf칤o para ganar puntos de experiencia</p>
                                </div>
                                <div class="text-end">
                                    <div class="mb-2">
                                        <span class="fw-bold text-primary" id="dailyProgress">0/5</span>
                                        <small class="text-muted"> completados</small>
                                    </div>
                                    <button class="btn btn-primary btn-sm" onclick="startDailyChallenge()">
                                        <i class="fas fa-play me-1"></i> Comenzar
                                    </button>
                                </div>
                            </div>
                            <div class="level-indicator mt-2">
                                <div class="level-progress bg-info" style="width: 0%" id="dailyChallengeProgress"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sidebar -->
                <div class="col-lg-4">
                    <!-- Progress Stats -->
                    <div class="progress-section mb-4">
                        <h5 class="mb-3">Tu Progreso</h5>
                        
                        <div class="course-progress">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="mb-0">Matem치ticas B치sicas</h6>
                                <span class="badge bg-primary">65%</span>
                            </div>
                            <div class="level-indicator mb-2">
                                <div class="level-progress bg-success" style="width: 65%"></div>
                            </div>
                            <div class="d-flex justify-content-between">
                                <small class="text-muted">8 de 12 lecciones</small>
                                <a href="#" class="text-primary small">Continuar</a>
                            </div>
                        </div>
                        
                        <div class="course-progress">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="mb-0">Programaci칩n Python</h6>
                                <span class="badge bg-primary">30%</span>
                            </div>
                            <div class="level-indicator mb-2">
                                <div class="level-progress bg-warning" style="width: 30%"></div>
                            </div>
                            <div class="d-flex justify-content-between">
                                <small class="text-muted">3 de 10 lecciones</small>
                                <a href="#" class="text-primary small">Continuar</a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stats -->
                    <div class="row mb-4">
                        <div class="col-6">
                            <div class="stats-card">
                                <div class="achievement-badge">
                                    <i class="fas fa-book"></i>
                                </div>
                                <h4 id="coursesCompleted">3</h4>
                                <small class="text-muted">Cursos Completados</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stats-card">
                                <div class="achievement-badge">
                                    <i class="fas fa-trophy"></i>
                                </div>
                                <h4 id="problemsSolved">42</h4>
                                <small class="text-muted">Problemas Resueltos</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Achievements -->
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Logros Recientes</h5>
                            <div id="achievementsList">
                                <!-- Achievements will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <div class="floating-action">
        <button class="btn btn-primary btn-lg rounded-circle shadow" style="width: 60px; height: 60px;" onclick="showQuickActions()">
            <i class="fas fa-bolt"></i>
        </button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // User data and progress
        let userProgress = {
            overall: 65,
            level: "Intermedio",
            coursesCompleted: 3,
            problemsSolved: 42,
            dailyChallenge: {
                title: "Resolver 5 problemas matem치ticos",
                description: "Completa este desaf칤o para ganar puntos de experiencia",
                completed: 0,
                total: 5,
                type: "math_problems"
            },
            recommendations: [
                {
                    id: 1,
                    title: "Curso de Matem치ticas Intermedias",
                    description: "Profundiza en 치lgebra y c치lculo b치sico",
                    type: "course",
                    priority: "alta",
                    completed: false,
                    progress: 0,
                    action: "Ver Curso",
                    link: "/cursos"
                },
                {
                    id: 2,
                    title: "Practicar ecuaciones cuadr치ticas", 
                    description: "Ejercicios interactivos para dominar ecuaciones",
                    type: "practice",
                    priority: "alta",
                    completed: true,
                    progress: 100,
                    action: "Practicar",
                    link: "/resolver"
                },
                {
                    id: 3,
                    title: "Revisar conceptos de geometr칤a",
                    description: "Refuerza tus conocimientos de 치ngulos y figuras",
                    type: "review",
                    priority: "media",
                    completed: true,
                    progress: 100,
                    action: "Revisar",
                    link: "/curso/1/leccion/4"
                },
                {
                    id: 4,
                    title: "Proyecto: Calculadora B치sica",
                    description: "Aplica tus conocimientos en un proyecto real",
                    type: "project",
                    priority: "media",
                    completed: false,
                    progress: 30,
                    action: "Comenzar",
                    link: "/resolver"
                },
                {
                    id: 5,
                    title: "Evaluaci칩n de progreso mensual",
                    description: "Mide tu avance con esta evaluaci칩n integral",
                    type: "assessment",
                    priority: "baja",
                    completed: false,
                    progress: 0,
                    action: "Evaluar",
                    link: "/evaluacion-matematicas"
                }
            ],
            achievements: [
                {
                    id: 1,
                    title: "Primeros Pasos",
                    description: "Completaste tu primer curso",
                    icon: "fas fa-star",
                    earned: true,
                    date: "2023-10-15"
                },
                {
                    id: 2, 
                    title: "Resolvedor de Problemas",
                    description: "Resolviste 25 problemas",
                    icon: "fas fa-puzzle-piece",
                    earned: true,
                    date: "2023-11-02"
                },
                {
                    id: 3,
                    title: "Estudiante Constante",
                    description: "7 d칤as consecutivos de aprendizaje",
                    icon: "fas fa-calendar-check",
                    earned: false,
                    date: null
                }
            ]
        };

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            loadRecommendations();
            loadAchievements();
            updateProgressUI();
            setupEventListeners();
        });

        function initializePage() {
            // Update user stats
            document.getElementById('coursesCompleted').textContent = userProgress.coursesCompleted;
            document.getElementById('problemsSolved').textContent = userProgress.problemsSolved;
            document.getElementById('userLevel').textContent = userProgress.level;
            
            // Update overall progress
            updateProgressRing(userProgress.overall);
            document.getElementById('overallProgressText').textContent = `${userProgress.overall}% Completado`;
            
            // Update daily challenge
            document.getElementById('dailyChallengeTitle').textContent = userProgress.dailyChallenge.title;
            document.getElementById('dailyChallengeDesc').textContent = userProgress.dailyChallenge.description;
            updateDailyChallengeProgress();
        }

        function loadRecommendations() {
            const container = document.getElementById('recommendationsContainer');
            const countElement = document.getElementById('recommendationCount');
            
            // Filter out completed recommendations for count
            const activeRecommendations = userProgress.recommendations.filter(rec => !rec.completed);
            countElement.textContent = `${activeRecommendations.length} recomendaciones`;
            
            container.innerHTML = userProgress.recommendations.map(rec => `
                <div class="card recommendation-card card-${rec.priority}-priority" data-priority="${rec.priority}" data-completed="${rec.completed}">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div class="d-flex align-items-center">
                                <div class="completion-checkbox ${rec.completed ? 'checked' : ''}" 
                                     onclick="toggleCompletion(${rec.id})">
                                    ${rec.completed ? '<i class="fas fa-check"></i>' : ''}
                                </div>
                                <div class="ms-3">
                                    <h5 class="card-title mb-1">${rec.title}</h5>
                                    <p class="card-text text-muted">${rec.description}</p>
                                </div>
                            </div>
                            <span class="priority-badge badge bg-${getPriorityColor(rec.priority)}">${rec.priority.toUpperCase()}</span>
                        </div>
                        
                        ${rec.progress > 0 ? `
                        <div class="level-indicator mb-3">
                            <div class="level-progress bg-${getPriorityColor(rec.priority)}" style="width: ${rec.progress}%"></div>
                        </div>
                        ` : ''}
                        
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">
                                ${rec.completed ? 
                                    '<span class="text-success"><i class="fas fa-check-circle"></i> Completado</span>' : 
                                    `${rec.progress}% Progreso`}
                            </small>
                            <button class="btn btn-action btn-sm" onclick="handleRecommendationAction(${rec.id})">
                                ${rec.action}
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadAchievements() {
            const container = document.getElementById('achievementsList');
            
            container.innerHTML = userProgress.achievements.map(ach => `
                <div class="d-flex align-items-center mb-3 ${ach.earned ? '' : 'opacity-50'}">
                    <div class="achievement-badge" style="width: 40px; height: 40px; font-size: 1rem;">
                        <i class="${ach.icon}"></i>
                    </div>
                    <div class="ms-3 flex-grow-1">
                        <h6 class="mb-0">${ach.title}</h6>
                        <small class="text-muted">${ach.description}</small>
                        ${ach.earned ? `<small class="text-success">Obtenido: ${new Date(ach.date).toLocaleDateString()}</small>` : ''}
                    </div>
                    ${ach.earned ? '<i class="fas fa-check text-success"></i>' : '<i class="fas fa-lock text-muted"></i>'}
                </div>
            `).join('');
        }

        function updateProgressRing(percentage) {
            const circle = document.getElementById('overallProgressRing');
            const radius = 54;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (percentage / 100) * circumference;
            
            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            circle.style.strokeDashoffset = offset;
        }

        function updateDailyChallengeProgress() {
            const progress = (userProgress.dailyChallenge.completed / userProgress.dailyChallenge.total) * 100;
            document.getElementById('dailyChallengeProgress').style.width = `${progress}%`;
            document.getElementById('dailyProgress').textContent = `${userProgress.dailyChallenge.completed}/${userProgress.dailyChallenge.total}`;
        }

        function toggleCompletion(recommendationId) {
            const recommendation = userProgress.recommendations.find(rec => rec.id === recommendationId);
            if (recommendation) {
                recommendation.completed = !recommendation.completed;
                if (recommendation.completed) {
                    recommendation.progress = 100;
                    userProgress.overall = Math.min(100, userProgress.overall + 5);
                    updateProgressRing(userProgress.overall);
                    document.getElementById('overallProgressText').textContent = `${userProgress.overall}% Completado`;
                    
                    // Check if user leveled up
                    if (userProgress.overall >= 80 && userProgress.level === "Intermedio") {
                        userProgress.level = "Avanzado";
                        document.getElementById('userLevel').textContent = userProgress.level;
                        showLevelUpMessage();
                    }
                } else {
                    recommendation.progress = 0;
                    userProgress.overall = Math.max(0, userProgress.overall - 5);
                    updateProgressRing(userProgress.overall);
                    document.getElementById('overallProgressText').textContent = `${userProgress.overall}% Completado`;
                }
                loadRecommendations();
            }
        }

        function handleRecommendationAction(recommendationId) {
            const recommendation = userProgress.recommendations.find(rec => rec.id === recommendationId);
            if (recommendation) {
                // Simulate progress
                if (!recommendation.completed && recommendation.progress < 100) {
                    recommendation.progress = Math.min(100, recommendation.progress + 25);
                    if (recommendation.progress === 100) {
                        recommendation.completed = true;
                        userProgress.overall = Math.min(100, userProgress.overall + 5);
                        updateProgressRing(userProgress.overall);
                        document.getElementById('overallProgressText').textContent = `${userProgress.overall}% Completado`;
                    }
                    loadRecommendations();
                }
                
                // Navigate to the link (in a real app, this would redirect)
                alert(`Redirigiendo a: ${recommendation.link}`);
                // window.location.href = recommendation.link;
            }
        }

        function startDailyChallenge() {
            userProgress.dailyChallenge.completed = Math.min(
                userProgress.dailyChallenge.completed + 1, 
                userProgress.dailyChallenge.total
            );
            
            userProgress.problemsSolved++;
            document.getElementById('problemsSolved').textContent = userProgress.problemsSolved;
            
            updateDailyChallengeProgress();
            
            if (userProgress.dailyChallenge.completed === userProgress.dailyChallenge.total) {
                alert('춰Desaf칤o diario completado! +10 puntos de experiencia');
                userProgress.overall = Math.min(100, userProgress.overall + 2);
                updateProgressRing(userProgress.overall);
                document.getElementById('overallProgressText').textContent = `${userProgress.overall}% Completado`;
            }
        }

        function showQuickActions() {
            const actions = [
                { name: 'Problema R치pido', icon: 'fas fa-bolt', action: startQuickProblem },
                { name: 'Revisar Progreso', icon: 'fas fa-chart-line', action: showProgressDetails },
                { name: 'Nueva Recomendaci칩n', icon: 'fas fa-magic', action: generateNewRecommendation }
            ];
            
            // Simple implementation - in a real app you might use a modal
            alert('Acciones r치pidas:\n- Problema R치pido\n- Revisar Progreso\n- Nueva Recomendaci칩n');
        }

        function startQuickProblem() {
            alert('Iniciando problema r치pido de matem치ticas...');
            // This would navigate to a quick problem page
        }

        function showProgressDetails() {
            alert(`Tu progreso detallado:\n- Nivel: ${userProgress.level}\n- Cursos completados: ${userProgress.coursesCompleted}\n- Problemas resueltos: ${userProgress.problemsSolved}\n- Progreso general: ${userProgress.overall}%`);
        }

        function generateNewRecommendation() {
            const newRec = {
                id: userProgress.recommendations.length + 1,
                title: "Nuevo contenido recomendado",
                description: "Basado en tu actividad reciente",
                type: "course",
                priority: "media",
                completed: false,
                progress: 0,
                action: "Explorar",
                link: "/cursos"
            };
            
            userProgress.recommendations.push(newRec);
            loadRecommendations();
            alert('춰Nueva recomendaci칩n generada!');
        }

        function showLevelUpMessage() {
            alert('游꿀 춰Felicidades! Has alcanzado el nivel Avanzado');
        }

        function getPriorityColor(priority) {
            const colors = {
                'alta': 'danger',
                'media': 'warning', 
                'baja': 'success'
            };
            return colors[priority] || 'secondary';
        }

        function setupEventListeners() {
            // Filter buttons
            document.querySelectorAll('[data-filter]').forEach(button => {
                button.addEventListener('click', function() {
                    const filter = this.getAttribute('data-filter');
                    
                    // Update active button
                    document.querySelectorAll('[data-filter]').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Filter recommendations
                    document.querySelectorAll('.recommendation-card').forEach(card => {
                        if (filter === 'all') {
                            card.style.display = 'block';
                        } else {
                            const priority = card.getAttribute('data-priority');
                            card.style.display = priority === filter ? 'block' : 'none';
                        }
                    });
                });
            });
        }

        // Simulate real-time updates
        setInterval(() => {
            // Randomly update a recommendation progress
            const incompleteRecs = userProgress.recommendations.filter(rec => !rec.completed && rec.progress < 100);
            if (incompleteRecs.length > 0) {
                const randomRec = incompleteRecs[Math.floor(Math.random() * incompleteRecs.length)];
                randomRec.progress = Math.min(100, randomRec.progress + 5);
                
                if (randomRec.progress === 100) {
                    randomRec.completed = true;
                    userProgress.overall = Math.min(100, userProgress.overall + 5);
                    updateProgressRing(userProgress.overall);
                    document.getElementById('overallProgressText').textContent = `${userProgress.overall}% Completado`;
                }
                
                loadRecommendations();
            }
        }, 30000); // Update every 30 seconds
    </script>
</body>
</html>